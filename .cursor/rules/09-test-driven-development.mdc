---
name: test-driven-development
description: Use when implementing any feature or bugfix, before writing implementation code
alwaysApply: true
---

# Test-Driven Development (TDD)

## Core Principle

Write the test first. Watch it fail. Write minimal code to pass.

**If you didn't watch the test fail, you don't know if it tests the right thing.**

## The Iron Law

```
NO PRODUCTION CODE WITHOUT A FAILING TEST FIRST
```

Write code before the test? Delete it. Start over.

- Don't keep it as "reference"
- Don't "adapt" it while writing tests
- Delete means delete

## When to Use

**Always:** New features, bug fixes, refactoring, behavior changes

**Exceptions (ask first):** Throwaway prototypes, generated code, configuration files

## The Cycle

```
RED → GREEN → REFACTOR → Repeat
```

1. **RED**: Write one minimal failing test
2. **Verify RED**: Run test, confirm it fails for the right reason
3. **GREEN**: Write simplest code to pass
4. **Verify GREEN**: Run test, confirm all tests pass
5. **REFACTOR**: Clean up, keep tests green
6. **Repeat**: Next failing test

## Good Tests

| Quality | Good | Bad |
|---------|------|-----|
| **Minimal** | One behavior per test | `TestValidatesEmailAndDomainAndWhitespace` |
| **Clear** | Name describes behavior | `TestFunc1` |
| **Real** | Tests actual code | Tests mock behavior |

## Red Flags - STOP and Start Over

- Code before test
- Test passes immediately
- Can't explain why test failed
- Rationalizing "just this once"
- "I already manually tested it"
- "Tests after achieve the same purpose"
- "Keep as reference" or "adapt existing code"
- "Already spent X hours, deleting is wasteful"
- "This is different because..."

**All mean: Delete code. Start over with TDD.**

## Verification Checklist

Before marking work complete:

- [ ] Every new function/method has a test
- [ ] Watched each test fail before implementing
- [ ] Each test failed for expected reason (feature missing, not typo)
- [ ] Wrote minimal code to pass each test
- [ ] All tests pass
- [ ] Output pristine (no errors, warnings)
- [ ] Tests use real code (mocks only if unavoidable)
- [ ] Edge cases and errors covered

Can't check all boxes? You skipped TDD. Start over.

## When Stuck

| Problem | Solution |
|---------|----------|
| Don't know how to test | Write wished-for API. Write assertion first. Ask your human partner. |
| Test too complicated | Design too complicated. Simplify interface. |
| Must mock everything | Code too coupled. Use dependency injection. |

## Final Rule

```
Production code → test exists and failed first
Otherwise → not TDD
```

No exceptions without your human partner's permission.

## For Detailed Workflow

See `.cursor/skills/tdd-workflow/SKILL.md` for:
- Detailed RED-GREEN-REFACTOR examples with code
- Common rationalizations and rebuttals
- Why order matters (tests-first vs tests-after)
- Bug fix walkthrough example
